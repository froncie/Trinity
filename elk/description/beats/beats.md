# beats
---

### ⚡️ Gettting started

[Filebeat Document](https://www.elastic.co/guide/en/beats/filebeat/current/running-on-docker.html)

```bash
docker pull docker.elastic.co/beats/filebeat:8.2.2-amd64
```

Beats is a lightweight and easy-to-use data collector.
There are different types of beats.

| Beats        | Description                                                                      |
| ------------ | -------------------------------------------------------------------------------- |
| filebeat     | The log file is read and transmitted in real time.                               |
| heartbeat    | Check and monitor whether the service is active.                                 |
| metricbeat   | Periodically collect statistical indicators from services, or operating systems. |
| packetbeat   | Collect network data with a network packet analyzer.                             |
| auditbeat    | Collects logs generated by auditd that audits Linux system security information. |
| journalbeat  | Collect logs for services running as Linux systemd.                              |
| functionbeat | Collect data about the cloud service environment                                 |
| winlogbeat   | Collect event logs occurring in windows                                          |
| custombeats  | Open source beats such as apachebeat, kafkabeat, nginxbeat.                                                                                 |

### ⚡️ filebeat
The filebeat basically serves to bring logs loaded into log file.
proceeds in the order of **Input → harvester → spooler** 

```yaml
# filebeat.yml
# ./filebeat -c filebeat.yml setup 
filebeat.inputs:
  - type: log
    enabled: true
    paths:
      - /usr/share/filebeat/logs/*.log
  
output.elasticsearch:
  hosts: ['https://{ELASTICSEARCH_IP}:9200']
  username: 'ELASTIC_USERNAME'
  password: 'ELASTIC_PASSWORD'
# CERT for SSL Connection with Elasticsearch
  ssl.certificate_authorities:
    - /usr/share/filebeat/certs/http_ca.crt
    
setup.kibana:
  host: "{KIBANA_IP:}:5601"
```

Input type of filebeat

| Type      | description                                                      |
| --------- | ---------------------------------------------------------------- |
| log       | The log file of the file system is read from the specified path. |
| container | Read the container log files from container such as docker       |
| s3        | Read files in AWS S3 bucket                                      |
| kafka     | Kafka topic is read                                              | 

✨ filebeats execution

```bash
docker run {-d} --name filebeat --link elasticsearch:elasticsearch kibana:kibana docker.elastic.co/beats/filebeats:8.2.2-amd64 setup -e 
```

in this case, -e option will show us the logs kind of error or informations.

### ⚡️ Filebeat Settings

✨ ignore_older
ignore_older is the setting to read the latest file
```yaml
# ignore_older
# filebeat.yml
filebeat.inputs:
  - type: log
    enabled: true
    paths:
      - /usr/share/filebeat/logs/*.log
    
    # from 24 hours to NOW
    ignore_older: 24h
   
   ...

```

✨ Manage Multiline
How to handle when one log comes out on multiple lines.
Multiline in Log file can be processed. 

→ Multi Line Log
aoo
koo
boo
boo
zoo
boo

1. pattern
   -  Specify a pattern using a regular expression
```yaml
filebeat.inputs:
- type: log
- ...
  multiline.pattern: '^b' # If it starts with letter 'b'
```
1. negate
   - Inverts the pattern matching condition
```yaml
multiline.pattern: '^b'
multiline.negate: true or false # if it is false, it will be mached with that starts with 'b'. However, it is true, t will be inversed. 
```
2. match
   - before
```yaml
multiline.match: before
# The order is [Match Line] - [Not match Line]
```
   - after
 ```yaml
multiline.match: after
# The order is [Not match Line:] - [Match Line]
```

✨  Multiline Combinations
1. negate:false, match: before
   -  [Match Line] - [Not match Line]
1. negate:false, match: after
   - [Not match Line] - [Match Line]
2. negate:true, match: before
3. negate:true, match: after